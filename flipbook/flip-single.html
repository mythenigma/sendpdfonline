<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MaiPDF 单页翻页查看器</title>
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- Turn.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/1.0.2/turn.min.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: Arial, sans-serif;
    }

    #flipbook {
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      background: white;
    }

    .page {
      width: 100%;
      height: 100%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      border: 1px solid #ccc;
    }

    .page img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }

    .loading {
      color: white;
      font-size: 18px;
      text-align: center;
    }

    .page-number {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 12px;
    }

    .controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: rgba(0,0,0,0.8);
      padding: 10px 20px;
      border-radius: 25px;
      color: white;
    }

    .controls button {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 15px;
      margin: 0 5px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .controls button:hover {
      background: #0056b3;
    }

    .controls button:disabled {
      background: #666;
      cursor: not-allowed;
    }

    .page-info {
      margin: 0 15px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="container">
    <div class="loading">加载翻页书中...</div>
    <div id="flipbook" style="display: none;">
      <!-- 页面内容会通过JavaScript动态生成 -->
    </div>
  </div>

  <!-- 控制按钮 -->
  <div class="controls" id="controls" style="display: none;">
    <button id="prevBtn">上一页</button>
    <span class="page-info" id="pageInfo">1 / 10</span>
    <button id="nextBtn">下一页</button>
  </div>

  <script>
    $(document).ready(function() {
      const folderPath = './stflip/';
      const totalPages = 10;
      let loadedImages = 0;
      let currentPage = 1;
      
      // 预加载所有图片
      const imagePromises = [];
      
      for (let i = 1; i <= totalPages; i++) {
        const promise = new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = function() {
            console.log(`图片 ${i} 加载成功`);
            loadedImages++;
            resolve({
              pageNum: i,
              src: img.src,
              width: img.width,
              height: img.height
            });
          };
          img.onerror = function() {
            console.error(`图片 ${i} 加载失败`);
            resolve({
              pageNum: i,
              src: null,
              width: 400,
              height: 600
            });
          };
          img.src = `${folderPath}${i}.jpg`;
        });
        
        imagePromises.push(promise);
      }
      
      // 等待所有图片加载完成
      Promise.all(imagePromises).then(function(images) {
        console.log('所有图片处理完成，创建单页翻页书...');
        
        // 计算合适的尺寸
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const maxWidth = Math.min(600, screenWidth * 0.8);
        const maxHeight = Math.min(800, screenHeight * 0.8);
        
        // 创建页面
        images.forEach(function(imageData) {
          const page = $('<div class="page"></div>');
          
          if (imageData.src) {
            const img = $('<img>').attr('src', imageData.src).attr('alt', `第 ${imageData.pageNum} 页`);
            page.append(img);
          } else {
            // 如果图片加载失败，显示占位内容
            page.append(`<div>第 ${imageData.pageNum} 页<br>图片未找到</div>`);
          }
          
          // 添加页码
          const pageNumber = $('<div class="page-number"></div>').text(imageData.pageNum);
          page.append(pageNumber);
          
          $('#flipbook').append(page);
        });
        
        // 隐藏加载提示，显示翻页书
        $('.loading').hide();
        $('#flipbook').show();
        $('#controls').show();
        
        // 初始化Turn.js - 关键：单页模式配置
        try {
          $("#flipbook").turn({
            width: maxWidth,
            height: maxHeight,
            autoCenter: true,
            acceleration: true,
            gradients: true,
            elevation: 50,
            display: 'single',  // 关键：强制单页显示
            when: {
              turning: function(event, page, view) {
                console.log('正在翻到第', page, '页');
                currentPage = page;
                updateControls();
              },
              turned: function(event, page, view) {
                console.log('已翻到第', page, '页');
                currentPage = page;
                updateControls();
              }
            }
          });
          
          console.log('✅ 单页翻页书初始化成功');
          updateControls();
          
          // 添加键盘导航
          $(document).keydown(function(e) {
            if (e.keyCode == 37) { // 左箭头
              $("#flipbook").turn("previous");
            } else if (e.keyCode == 39) { // 右箭头
              $("#flipbook").turn("next");
            }
          });
          
          // 控制按钮事件
          $('#prevBtn').click(function() {
            $("#flipbook").turn("previous");
          });
          
          $('#nextBtn').click(function() {
            $("#flipbook").turn("next");
          });
          
        } catch (error) {
          console.error('翻页书初始化失败:', error);
          $('.loading').text('翻页书加载失败，请检查Turn.js库。');
        }
      });
      
      // 更新控制按钮状态
      function updateControls() {
        $('#pageInfo').text(`${currentPage} / ${totalPages}`);
        
        // 更新按钮状态
        $('#prevBtn').prop('disabled', currentPage <= 1);
        $('#nextBtn').prop('disabled', currentPage >= totalPages);
      }
    });
  </script>
</body>
</html>
